import socket
import threading
from colorama import Fore, init

init(autoreset=True)

nickname = input("Digite seu apelido: ")

client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
    client.connect(('127.0.0.1', 55555))
except ConnectionRefusedError:
    print(Fore.RED + "N√£o foi poss√≠vel conectar ao servidor.")
    exit()

running = True

def receive():
    global running
    while running:
        try:
            message = client.recv(1024).decode('utf-8')
            if not message:
                break
            if message == 'NICK':
                client.send(nickname.encode('utf-8'))
            else:
              
                if f">> {nickname} foi banido" in message.lower() or f">> {nickname} saiu do chat" in message.lower():
                    continue


                if "saiu do chat" in message.lower():
                    print(Fore.RED + message)
                elif "banido" in message.lower() or "üö´" in message:
                    print(Fore.RED + message)
                elif "aviso" in message.lower() or "‚ö†Ô∏è" in message:
                    print(Fore.YELLOW + message)
                else:
                    print(Fore.GREEN + message)
        except:
            print(Fore.RED + "Voc√™ foi desconectado do servidor.")
            client.close()
            running = False
            break


def write():
    global running
    while running:
        msg = input("")
        if msg.lower() == "/quit":
        
            client.send(f"<< {nickname} saiu do chat >>".encode('utf-8'))
            client.close()
            running = False
            break

        if not msg.strip():
            continue

        message = f"[{nickname}] {msg}"
        client.send(message.encode('utf-8'))

# Inicia as threads
threading.Thread(target=receive, daemon=True).start()
threading.Thread(target=write, daemon=True).start()

# Mant√©m o programa ativo
while running:
    pass
